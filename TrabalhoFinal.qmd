---
title: "Simulação probabilística do ROI de um parque eólico"
date: 2024-02-12
author:
  - name: Sérgio Duarte
    email: 2302287@estudante.uab.pt 
    affiliation: 
      - name: Universidade Aberta
      - department: Estatística I
format: 
  pdf:
      page-layout: article
editor: 
  markdown:
    wrap: 72
bibliography: bibliografia.bib
biblio-style: "apalike"
link-citations: true
---

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
library(stats)
library(dplyr)
library(mixtools)
library(latex2exp)
library(hrbrthemes)
source('src/vento.R')
source('src/energia.R')
source('src/turbina.R')
source('src/simulacao.R')
```


# Resumo

# Enquadramento

Uma correcta avaliação da viabilidade económica de um projecto de
energia eólica é seguramente um dos pontos mais importantes no
desenvolvimento do mesmo @intro. Esta avaliação representa um desafio
uma vez que o cálculo da mesma está necessariamente assente em processos
estocásticos: a velocidade do vento e o preço da energia. A potência
eólica disponível para extração varia com o cubo da velocidade do vento,
pelo que aproximar o cálculo energético através de valores médios pode
levar erros grosseiros que mascaram a incerteza associada ao
projecto\[**ref: Introdução**\].

Modelar a incerteza deste processo pode então revelar-se crucial para
uma melhor avaliação do risco associado ao projecto.

## Contexto financeiro

Um projecto de produção de energia deverá ser avaliado financeiramente
como qualquer investimento. Desta forma, torna-se importante
contabilizar todos os encargos e recebimentos associados ao projecto, de
modo a calcular o mapa de fluxo de caixa (*cashflow*).

Importa clarificar algumas definições antes de avançar para a
metodologia de cálculo.

Taxa de atualização: $a = [(1+T1)(1+T2)(1+T3)]-1$,

onde:

$T1:$ taxa de rendimento real

$T2:$ taxa de risco

$T3:$ taxa de inflação

No caso presente a taxa de inflação será assumida como nula, pois afeta
recebimentos e pagamentos (chamada de avaliação a preços constantes).

Os indicadores comuns de avaliação de investimentos são:

- Valor Atual Líquido (VAL);
- Taxa Interna de Rendibilidade (TIR);

O VAL é dado por:

$$
VAL = \sum_{j=i}^n\frac{R_{Lj}}{(1+a)^j} - \sum_{j=0}^{n-1} \frac{I_j}{(1+a)^j}
$$

onde n é o tempo de vida útil do investimento em anos, $R_{Lj}$ é o retorno anual 
líquido, dado por $R_j-Operaçao\&Manutenção$ e $I_j$ representa a anuidade do investimento no ano j. 
Este valor representa o retorno esperado no final do tempo de vida útil do investimento. 
A TIR representa a taxa de atualização que anula o VAL, ou seja, a taxa de rendibilidade mínima necessária para cobrir o investimento efetuado.
Este valor pode ser obtido através da optimização da seguinte expressão:
$$
\sum_{j=i}^n\frac{R_{Lj}}{(1+TIR)^j} - \sum_{j=0}^{n-1} \frac{I_j}{(1+TIR)^j} = 0
$$

Para calcular estes indicadores é necessário obter dados de:

  - Investimento inicial
  - O&M
  - Retorno 

No presente estudo será assumido que não existem regimes bonificados e toda a energia é
vendida a preço de mercado, pelo que este preço deverá ser obtido de uma
distribuição anual de preços.


## Contexto energético

O retorno de um investimento eólico está directamente relacionado com o recurso 
disponível na área de instalação do projeto. Tipicamente, a velocidade do vento segue uma distribuição de Weibull, tal que $X \sim Weibull(\beta, \theta)$, onde $\beta$ é o factor de forma e $\theta$ o factor de escala da distribuição. Esta distribuição tem a seguinte função densidade de probabilidade:
$$
f(x|{\beta, \theta}) = \frac{\beta}{\theta^\beta}x^{\beta-1}e^{-(\frac{x}{\theta})^\beta}
$$
```{r echo=FALSE}
beta <- 2
theta <- 7

v <- seq(0,26, length.out=100)
p <- dweibull(v, beta, theta)
data.frame(v,p) %>% 
  ggplot(aes(x=v, y=p)) + 
  geom_line() + 
  labs(
    x = "velocidade de vento [m/s]", 
    y = "f(x)", 
    title = TeX("Densidade de probabilidade de $Weibull(\\beta, \\theta)$"),
  ) + theme_minimal()


```

Com base nesta distribuição podemos simular as velocidade de vento esperadas durante o tempo de vida do projecto e assim estimar a energia produzida. 
Através da curva de potência característica de uma turbina eólica é possível converter a velocidade de vento numa potência.


```{r echo=FALSE}
source('src/turbina.R')

pt <- curva.potencia(v)
data.frame(v, pt) %>% 
  ggplot(aes(x=v, y=pt)) + 
  geom_line() + 
  labs(
    x = "velocidade de vento [m/s]", 
    y = TeX("$\\frac{P}{P_{nominal}}$"), 
    title = TeX("Exemplo da curva de potência de uma turbina eólica"),
  ) + theme_minimal()

```


-   curva potência das turbinas

    -   custo de energia


### **Objectivo da simulação!!!**

***Tempo de vida útil de um parque eólico -\> queremos saber a
probabilidade de obter retorno (ou uma TIR específica por exemplo)
dentro desse tempo de vida***

-   I95% para TIR que anula o VAL-

# Metodologia

Custo inicial de instalação e O&M

> Em termos gerais, pode afirmar-se que, para Portugal, o investimento
> unitário total poderá variar entre um valor médio-baixo de 1000 €/kW e
> um valor médio-alto de 1500 €/kW, sendo o investimento unitário médio
> reportado de 1297 €/kW (\[Fonte: International Energy Agency\])\*.
> Para os encargos de O&M, um valor médio entre 1% e 2% do investimento
> total é correntemente usado.

selecionar turbina

-   altura

-   curva de potência

-   custo

Extrapolar altitude -\> lei de prantl

-   altura da turbina

obter dados de preços de mercado e dados de velocidades de vento.

2022 -\> facilidade de obtenção

vento: reanálises (usar 3 anos de dado)

-   ajustar uma distribuição de Weibull

    -   obter estimadores de máxima verosimilhança para os parâmetros

    -   calcular parâmetros

    -   obter função de probabilidade inversa

preço: omie

descrever a metodologia da simulação

resultado final será uma aplicação shiny ()

-   tipos de terreno -\> rugosidade

-   altitude

## Arquitetura da simulação

**Objectivo claro: Obter intervalo de confiança para TIR, dados os
custos iniciais e vida útil do projecto**

Procedimentos preliminares:

-   Obter custos iniciais

    -   Custos de instalação

    -   Custos dos equipamentos

    -   Custos de O&M

    -   Taxa de atualização -\> como definir?

    -   definir como vai ser pago o investimento

-   Obter dados velocidade de vento

    -   Ajustar distribuição de Weibull

        -   Segmentar? (sazonal? dia/noite? -\> ver literatura)

-   Obter dados de mercado

    -   Ajustar distribuição (provavelmente faz sentido segmentar,
        dia/noite, sazonal, etc)

-   Obter curva de potência da turbina selecionada

Simulação de Monte Carlo (granularidade horária, *N* horas, *i*
iterações):

-   Dividir tempo de vida útil em horas (*N*)

-   Criar vector vazio de TIR de tamanho *i*

-   Correr *i* vezes:

    -   Criar vector de velocidades de vento de tamanho *N*

    -   Preencher vector com valores aleatórios retirados da
        distribuição de Weibull obtida anteriormente

    -   Aplicar curva de potência ao vector de velocidade de vento para
        obter a potência horária

        -   Como os segmentos são horários, a potência equivale à
            energia E = P \* dt, dt = 1

    -   Criar vector de preços horários de energia de tamanho *N*

    -   Preencher vector com valores aleatórios retirados da
        distribuição de preços

    -   Multiplicação elementar dos vectores energia e vento

    -   Fazer agregação (anual?) -\> aplicar taxa de atualização

    -   Fazer balanço 

    -   Calcular taxa interna de rendibilidade

    -   Guardar resultado

-   Obter distribuição de TIR

# **Resultados e discussão**


### Simulação

1.  Estimar ROI valores fixos para energia produzida e preço com base
    nos parâmetros das distribuições observadas
2.  Estimar ROI com valor de energia simulado e preço fixo
3.  **???** Estimar ROI com ambos os valores de energia e preço fixos
    **???**
4.  **???** Estimar com cadeias de markov **???**

Escrever código da simulação de forma modular para que seja possível
subsitiuir as funções facilmente!!

```{r}

velocidade.vento <- read.csv('dados/velocidade_de_vento.csv')
# removemos os ano de 2020 porque foi anómalo em termos do consumo de energia
precos.energia <- read.csv('dados/precos_energia.csv') %>% filter(ano != 2020)

```

### Análise exploratória

```{r}
hist(velocidade.vento$velocidade_de_vento)
```

```{r}
hist(precos.energia$preco, breaks = 30)
```

```{r}
n.sim <- 1 # 
potencia.turbina <- 1 # MW
numero.turbinas <- 10
tempo.vida <- 20 # anos
taxa.de.atualização <- .11

params.weibull <- mle.weibull(velocidade.vento$velocidade_de_vento)
params.mistura <- normalmixEM(precos.energia$preco, k=3)

retorno <- replicate(n.sim, 
                      simulacao.retorno(potencia.turbina, 
                                        numero.turbinas, 
                                        tempo.vida, 
                                        taxa.de.atualização, 
                                        params.weibull, 
                                        params.mistura))

hist(retorno)
```

# Conclusão

# Bibliografia

<https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-single-levels?tab=form>

<https://www.r-bloggers.com/2018/08/structuring-r-projects/>

<https://github.com/ecmwf/eccodes-python?tab=readme-ov-file>

<https://docs.xarray.dev/en/stable/user-guide/time-series.html>

<https://github.com/ecmwf/cfgrib>

<https://www.r-bloggers.com/2019/08/maximum-likelihood-estimation-from-scratch/>

<https://www.uaar.edu.pk/fs/books/12.pdf>

<https://scholarsarchive.byu.edu/cgi/viewcontent.cgi?article=3508&context=etd>
